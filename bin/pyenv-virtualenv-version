#!/usr/bin/env bash
# Usage: pyenv virtualenv-version
# Summary: Show the version of the current Python virtual environment

set -e
[ -n "$PYENV_DEBUG" ] && set -x

# Provide pyenv completions
if [ "$1" = "--complete" ]; then
  exec pyenv-virtualenvs --bare
fi

if [ -n "$1" ]; then
  OLDIFS="$IFS"
  { IFS=:
    export PYENV_VIRTUAL_ENV="$*"
  }
  IFS="$OLDIFS"
elif [ -z "$PYENV_VIRTUAL_ENV" ]; then
  PYENV_VIRTUAL_ENV="$(pyenv-virtualenv-name)"
fi

PYENV_VIRTUAL_ENV_PREFIX="$(pyenv-virtualenv-prefix "$PYENV_VIRTUAL_ENV" 2>/dev/null || true)"
PYENV_VIRTUAL_ENV_VERSION="$(basename "$PYENV_VIRTUAL_ENV_PREFIX")"

OLDIFS="$IFS"
IFS=$'\n' scripts=(`pyenv-hooks virtualenv-version`)
IFS="$OLDIFS"
for script in "${scripts[@]}"; do
  source "$script"
done

if [ -n "$PYENV_VIRTUAL_ENV_VERSION" ]; then
  echo "$PYENV_VIRTUAL_ENV_VERSION"
  exit
fi

exit 1
